#
## This file is generated by bootstrap.sh. Edit that file, not this
#

cmake_minimum_required (VERSION 2.6)
project (libbats)

set(CMAKE_MODULE_PATH ${CMAKE_SOURCE_DIR}/cmake/)
set(BUILD_SHARED_LIBS ON CACHE BOOL "Choose whether to build a shared library")

INCLUDE(FindPkgConfig)

find_package(Eigen3 REQUIRED)
find_package(LibXml2 REQUIRED)
find_package(SigC++ REQUIRED)
PKG_CHECK_MODULES(GTKMM gtkmm-2.4)
find_package(Doxygen)
find_package(LATEX)

set(CMAKE_CXX_FLAGS "-std=c++0x -Wno-deprecated-register")

#
## libbats
#

set(LIBBATS_SOURCES
./Types/dualOf.cc
./Types/getPlayerWithUnum.cc
./Types/objectEnumFor.cc
./Types/isTeamMate.cc
./Types/unumFor.cc
./Types/nameOf.cc
./Path/init.cc
./Path/path.cc
./Distribution/NormalDistribution/getP.cc
./Distribution/NormalDistribution/draw.cc
./Distribution/NormalDistribution/init.cc
./Distribution/NormalDistribution/predict.cc
./Distribution/NormalDistribution/update.cc
./SocketComm/connect.cc
./SocketComm/sendmessage.cc
./SocketComm/initConnection.cc
./SocketComm/nextMessage.cc
./SocketComm/AgentSocketComm/moveUniversalJoint.cc
./SocketComm/AgentSocketComm/makemovetorquejointmessage.cc
./SocketComm/AgentSocketComm/syn.cc
./SocketComm/AgentSocketComm/moveHingeJoint.cc
./SocketComm/AgentSocketComm/say.cc
./SocketComm/AgentSocketComm/movetorquejoint.cc
./SocketComm/AgentSocketComm/init.cc
./SocketComm/AgentSocketComm/makeMoveHingeJoint.cc
./SocketComm/AgentSocketComm/update.cc
./SocketComm/AgentSocketComm/moveJoint.cc
./SocketComm/AgentSocketComm/beam.cc
./SocketComm/SocketComm.cc
./SocketComm/receive.cc
./SocketComm/parseInput.cc
./SocketComm/TrainerSocketComm/setPlayMode.cc
./SocketComm/TrainerSocketComm/static.cc
./SocketComm/TrainerSocketComm/init.cc
./SocketComm/TrainerSocketComm/setBallVel.cc
./SocketComm/TrainerSocketComm/setBallPos.cc
./SocketComm/TrainerSocketComm/kickOff.cc
./SocketComm/TrainerSocketComm/setBallPosVel.cc
./SocketComm/initSocket.cc
./SocketComm/send.cc
./WorldModel/onMySide.cc
./WorldModel/onMyBelly.cc
./WorldModel/otherCloserTo.cc
./WorldModel/updateGameState.cc
./WorldModel/initJoints.cc
./WorldModel/getDirectionOfFall.cc
./WorldModel/worldmodel.cc
./WorldModel/onMyFeet.cc
./WorldModel/static.cc
./WorldModel/update.cc
./WorldModel/initWeights.cc
./WorldModel/getDirectionOfOpponentGoal.cc
./WorldModel/onMyBack.cc
./Cochlea/translateInfo.cc
./Cochlea/parsePolar.cc
./Cochlea/Cochlea.cc
./Cochlea/getLineJunctions.cc
./Cochlea/parseScalar.cc
./Cochlea/parseVect.cc
./Cochlea/parseTransform.cc
./Cochlea/update.cc
./Cochlea/synthesizeDerivedData.cc
./Cochlea/integrate.cc
./Cochlea/nameOf.cc
./Socket/socket.cc
./ObjectInfo/DynamicObjectInfo/PlayerInfo/PlayerInfo.cc
./ObjectInfo/ObjectInfo.cc
./Parser/parse.cc
./Parser/parser0.cc
./Parser/generate.cc
./Parser/initialize.cc
./Parser/static.cc
./AST/find.cc
./AST/finddeep.cc
./AST/findall.cc
./AST/findalldeep.cc
./AST/selectall.cc
./AST/select.cc
./PlayerClass/static.cc
./Conf/selectxpath.cc
./Conf/parseConf.cc
./Conf/Conf.cc
./Clock/RC3DClock/update.cc
./Math/makeRotation.cc
./Math/distanceLinePoint.cc
./Math/linePointClosestToPoint.cc
./Math/cartesianToPolar.cc
./Math/calcperpend.cc
./Math/intersectLineCircle.cc
./Math/intersectLines2D.cc
./Math/intersectVectorPlane.cc
./Math/atSameSideOf.cc
./Math/polarToCartesian.cc
./Localizer/getFilteredPlayers.cc
./Localizer/KalmanLocalizer/addGlobalMeasurement.cc
./Localizer/KalmanLocalizer/updateGlobalRotation.cc
./Localizer/KalmanLocalizer/KalmanLocalizer.cc
./Localizer/KalmanLocalizer/onBeam.cc
./Localizer/KalmanLocalizer/getGoalMidpoint.cc
./Localizer/KalmanLocalizer/init.cc
./Localizer/KalmanLocalizer/update.cc
./Localizer/KalmanLocalizer/tryObserveGlobalRotation.cc
./Localizer/KalmanLocalizer/updatePlayersGlobal.cc
./Localizer/KalmanLocalizer/updateBallGlobal.cc
./Localizer/KalmanLocalizer/updateSelfGlobal.cc
./Localizer/KalmanLocalizer/updateRaw.cc
./Localizer/KalmanLocalizer/getCochleaIdForObject.cc
./Localizer/KalmanLocalizer/globalToLocal.cc
./Localizer/KalmanLocalizer/getDirections.cc
./Localizer/getFilteredObjects.cc
./Localizer/getAliveObjects.cc
./Localizer/SimpleLocalizer/SimpleLocalizer.cc
./Localizer/SimpleLocalizer/update.cc
./JointController/GaitGenerator/IKGaitGenerator/determineNextStep.cc
./JointController/GaitGenerator/IKGaitGenerator/doStep.cc
./JointController/GaitGenerator/IKGaitGenerator/determineSwingFootEnd.cc
./JointController/GaitGenerator/IKGaitGenerator/resetGait.cc
./JointController/GaitGenerator/IKGaitGenerator/updatePhase.cc
./JointController/GaitGenerator/IKGaitGenerator/IKGaitGenerator.cc
./JointController/GaitGenerator/IKGaitGenerator/updateSpeed.cc
./JointController/GaitGenerator/IKGaitGenerator/fillJointAngles.cc
./JointController/GaitGenerator/IKGaitGenerator/run.cc
./JointController/MotionSequencePlayer/loadSequenceFromConf.cc
./JointController/MotionSequencePlayer/runCurrentStep.cc
./JointController/MotionSequencePlayer/checkSequenceDone.cc
./JointController/MotionSequencePlayer/checkFirstRun.cc
./JointController/MotionSequencePlayer/run.cc
./HumanoidAgent/startUp.cc
./HumanoidAgent/static.cc
./HumanoidAgent/run.cc
./Random/seed.cc
./Random/stdNorm.cc
./Random/uniform2.cc
./Random/uniform.cc
./Predicate/destroy.cc
./Predicate/copy.cc
./Predicate/generate.cc
./Predicate/operator0.cc
./Predicate/toString.cc
./PortableParser/static.cc
./AgentModel/onMySide.cc
./AgentModel/onMyBelly.cc
./AgentModel/getJointName.cc
./AgentModel/checkDirectionOfFall.cc
./AgentModel/getBodyCopy.cc
./AgentModel/AgentModel.cc
./AgentModel/initBody2.cc
./AgentModel/updatePosture.cc
./AgentModel/updateCOM.cc
./AgentModel/setUnum.cc
./AgentModel/onMyFeet.cc
./AgentModel/jointAnglesForAnklePosition.cc
./AgentModel/predict.cc
./AgentModel/update.cc
./AgentModel/isDown.cc
./AgentModel/initBody.cc
./AgentModel/getBodyPartCopy.cc
./AgentModel/onMyBack.cc
./Cerebellum/cerebellum.cc
./Cerebellum/addAction.cc
./Cerebellum/outputCommands.cc
./Debugger/RoboVizDebugger/drawCurve.cc
./Debugger/RoboVizDebugger/getSetName.cc
./Debugger/RoboVizDebugger/drawPoint.cc
./Debugger/RoboVizDebugger/drawLine.cc
./Debugger/RoboVizDebugger/drawProgressCircle.cc
./Debugger/RoboVizDebugger/drawSphere.cc
./Debugger/RoboVizDebugger/reDraw.cc
./Debugger/RoboVizDebugger/RoboVizDebugger.cc
./Debugger/RoboVizDebugger/start.cc
./Debugger/RoboVizDebugger/drawTransformationAxes.cc
./Debugger/RoboVizDebugger/init.cc
./Debugger/RoboVizDebugger/plot.cc
./Debugger/RoboVizDebugger/onThinkEnd.cc
./Debugger/RoboVizDebugger/drawPolygon.cc
./Debugger/RoboVizDebugger/drawAgentAnnotation.cc
./Debugger/RoboVizDebugger/drawAnnotation.cc
./Debugger/RoboVizDebugger/drawShapes.cc
./Debugger/RoboVizDebugger/drawPlayerSkeleton.cc
./Debugger/RoboVizDebugger/drawCircle.cc
./SocketAddress/socketaddress.cc
./TimeVal/timeval.cc
)

set(LIBBATS_INCLUDE_DIRS ${EIGEN3_INCLUDE_DIR} ${LIBXML2_INCLUDE_DIR} ${SigC++_INCLUDE_DIRS} ${LIBXMLXX_INCLUDE_DIRS})

# Only build GTK debugger if GTKmm was found
if(GTKMM_FOUND)
  list(APPEND LIBBATS_SOURCES
       ./Debugger/GtkDebugger/onDebugText.cc
       ./Debugger/GtkDebugger/run.cc
       ./Debugger/GtkDebugger/onThinkEnd.cc
       ./Debugger/GtkDebugger/drawShapes.cc
       ./Debugger/GtkDebugger/GtkDebugger.cc
       ./Debugger/GtkDebugger/drawBall.cc
       ./Debugger/GtkDebugger/drawCurve.cc
       ./Debugger/GtkDebugger/plot.cc
       ./Debugger/GtkDebugger/drawPlayers.cc
       ./Debugger/GtkDebugger/start.cc
       ./Debugger/GtkDebugger/drawSelf.cc
       ./Debugger/GtkDebugger/init.cc
       ./Debugger/GtkDebugger/drawField.cc
       ./Debugger/GtkDebugger/reDraw.cc
       ./Debugger/GtkDebugger/onDrawingAreaExpose.cc
  )

  list(APPEND LIBBATS_INCLUDE_DIRS ${GTKMM_INCLUDE_DIRS})
else(GTKMM_FOUND)
  message(STATUS "  GtkDebugger will not be built")
endif(GTKMM_FOUND)

include_directories(${LIBBATS_INCLUDE_DIRS} ${CMAKE_BINARY_DIR})

configure_file (
  "${CMAKE_SOURCE_DIR}/configure.hh.in"
  "${CMAKE_BINARY_DIR}/configure.hh"
)

configure_file(xml/conf.xml xml/conf.xml COPYONLY)
configure_file(xml/conf.dtd xml/conf.dtd COPYONLY)
configure_file(xml/nao_mdl.xml xml/nao_mdl.xml COPYONLY)

add_library(bats
${LIBBATS_SOURCES}
)

target_link_libraries(bats ${LIBXML2_LIBRARIES} ${SigC++_LIBRARIES})

#
## HTML documentation with doxygen
#
if(DOXYGEN_FOUND)
  configure_file(${CMAKE_CURRENT_SOURCE_DIR}/Doxyfile.in ${CMAKE_CURRENT_BINARY_DIR}/Doxyfile @ONLY)
  add_custom_target(doc ALL
                    ${DOXYGEN_EXECUTABLE} ${CMAKE_CURRENT_BINARY_DIR}/Doxyfile
                    WORKING_DIRECTORY ${CMAKE_CURRENT_BINARY_DIR}
                    COMMENT "Generating API documentation with Doxygen" VERBATIM
  )
endif(DOXYGEN_FOUND)

#
## PDF manual
#
if (PDFLATEX_COMPILER)
  SET(PDFLATEX_COMMAND  ${PDFLATEX_COMPILER} -interaction=batchmode -halt-on-error -output-directory ${CMAKE_CURRENT_BINARY_DIR}/docs/manual libbatsmanual.tex)
  add_custom_target(manual ALL
                    mkdir -p ${CMAKE_CURRENT_BINARY_DIR}/docs/manual && ${PDFLATEX_COMMAND} && ${PDFLATEX_COMMAND}
                    WORKING_DIRECTORY ${CMAKE_CURRENT_SOURCE_DIR}/docs/manual
                    COMMENT "Generating manual with pdfLaTeX"
  )
endif(PDFLATEX_COMPILER)

install(TARGETS bats DESTINATION lib)

# Macro used to install headers under correct directory structure
macro(INSTALL_HEADERS_WITH_DIRECTORY DESTINATION HEADER_LIST)
  foreach(HEADER ${${HEADER_LIST}})
    get_filename_component(FILE ${HEADER} NAME) 
    string(REPLACE ${FILE} "" DIR ${HEADER})
    install(FILES ${HEADER} DESTINATION ${DESTINATION}/${DIR})
  endforeach(HEADER)
endmacro(INSTALL_HEADERS_WITH_DIRECTORY)

set(LIBBATS_HEADERS ./Types/types.hh
./SituationDetector/SimpleSituationDetector/simplesituationdetector.hh
./SituationDetector/situationdetector.hh
./Path/path.hh
./Distribution/distribution.hh
./Distribution/NormalDistribution/normaldistribution.hh
./SocketComm/AgentSocketComm/agentsocketcomm.hh
./SocketComm/socketcomm.hh
./SocketComm/TrainerSocketComm/trainersocketcomm.hh
./WorldModel/worldmodel.hh
./Cochlea/cochlea.hh
./Socket/socket.hh
./ObjectInfo/DynamicObjectInfo/PlayerInfo/playerinfo.hh
./ObjectInfo/DynamicObjectInfo/dynamicobjectinfo.hh
./ObjectInfo/objectinfo.hh
./BatsEvent/batsevent.hh
./Parser/parser.hh
./AST/ast.hh
./Singleton/singleton.hh
./DistributionTracker/distributiontracker.hh
./PlayerClass/playerclass.hh
./Shape/shape.hh
./Conf/conf.hh
./Conf/xmlattr.hh
./Conf/xmlnodeset.hh
./Conf/xmlnode.hh
./Clock/RC3DClock/rc3dclock.hh
./Clock/clock.hh
./Action/action.hh
./Action/RC3DAction/rc3daction.hh
./Math/config.hh
./Math/basicmath.hh
./Math/math.hh
./Localizer/KalmanLocalizer/kalmanlocalizer.hh
./Localizer/SimpleLocalizer/simplelocalizer.hh
./Localizer/localizer.hh
./JointController/GaitGenerator/gaitgenerator.hh
./JointController/GaitGenerator/IKGaitGenerator/ikgaitgenerator.hh
./JointController/MotionSequencePlayer/motionsequenceplayer.hh
./JointController/jointcontroller.hh
./HumanoidAgent/humanoidagent.hh
./Configurable/configurable.hh
./PCSelector/pcselector.hh
./PCSelector/UnumPCSelector/unumpcselector.hh
./Preprocessor/debug.hh
./Preprocessor/foreach.hh
./MotionSequence/motionsequence.hh
./Random/random.hh
./Predicate/predicate.hh
./PortableParser/portableparser.hh
./BodyPart/bodypart.hh
./Range/range.hh
./AgentModel/agentmodel.hh
./Cerebellum/cerebellum.hh
./Debugger/RoboVizDebugger/robovizdebugger.hh
./Debugger/debugger.hh
./Debugger/GtkDebugger/gtkdebugger.hh
./Debugger/EmptyDebugger/emptydebugger.hh
./docs/doc.hh
./SocketAddress/socketaddress.hh
./BatsException/batsexception.hh
./TimeVal/timeval.hh)

install_headers_with_directory(include/libbats "LIBBATS_HEADERS")

install(FILES xml/conf.xml xml/nao_mdl.xml  DESTINATION share/libbats/xml/)

add_subdirectory(examples)

